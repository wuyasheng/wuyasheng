---
title: AMBA AXI总线介绍
author: yasheng
img: /medias/featureimages/amba.jpg
toc: true
mathjax: true
summary: 本文整理AMBA AXI总线知识
categories: FPGA-详解
tags:
  - AXI
  - AMBA
abbrlink: 2343156131
date: 2020-08-26 22:27:09
password:
layout:
---


## AXI 总线协议介绍

---

 注 : 本文内容收集至网络，[参考文-1](https://www.cnblogs.com/uiojhi/archive/2018/07/31/9366884.html)、[参考文-2](https://blog.csdn.net/u011280717/article/details/81052436)、[参考文-3](https://www.cnblogs.com/yuandonghua/p/11936357.html)、[参考文-4](https://www.cnblogs.com/yiwenbo/p/10167107.html)、[参考文-5](https://www.cnblogs.com/mao0504/p/5441234.html)

文章内容来自百度文库[原文链接](https://wenku.baidu.com/view/45491979bf1e650e52ea551810a6f524ccbfcbd5.html?rec_flag=default&sxts=1582552068762)

<img src="/images/post_images/amba_02_ahb/amba_ahb_01.png">

### **1、AXI 概述**

Xilinx同ARM密切合作,共同为基于FPGA的高性能系统和设计定义了AXI4规范。并且在其新一代可编程门阵列芯片上采用了高级可扩展接口( Advanced Tensible interface，AXI协议）

AXI总线是ARM高级微控制器总线结构( Advanced Microcontroller Bus architecture,AMBA)的一部分。

AXI总线的第一个版本包含在AMBA3.0(2003年发布)中，AXI总线的第二个版本AX4包含在AMBA40(2010年发布)中。

最新一代的AMBA接口的目标是

1. 适合于高带宽和低延迟设计；
2. 在不使用复杂的桥接方式下,允许更高频率的操作；
3. 满足普遍情况下的元件接口要求；
4. 适用于高初始访问延迟的存储器控制器；
5. 为互联结构的实现提供了灵活性；
6. 与已有的AHB和APB接口向下兼容；

#### 1.1 AXI 协议的关键特性表现

1. 独立的地址/控制和数据阶段；
2. 使用字节选通,支持非对齐的数据传输；
3. 只有开始地址的猝发交易；
4. 独立的读和写数据通道,可以使能低成本的直接存储器访问DMA传输；
5. 能发出多个未解决的地址；
6. 完成无序交易；
7. 容易添加寄存器切片,满足时序收敛要求；

#### 1.2 更高的生产率主要体现

1. 将多种不同的接口整合到一个接口(AXI4)中,因此用户仅需了解单个系列的接口；
2. 简化了不同领域IP的集成，并使自身或第三方合作伙伴P的开发工作更简单易行；
3. 由于AXI4已为实现最高性能、最大吞吐量以及最低时延进行了优化，从而使设计工作进一步获得简化；

#### 1.3 更大的灵活性体现

1. 支持嵌入式、DSP及逻辑版本用户；
2. 调节互连机制,满足系统要求:性能、面积及功耗；
3. 帮助设计者在目标市场中构建最具号召力的产品；

#### 1.4 提供了广泛的IP可用性

1. 第三方IP和EDA厂商普遍采用开放式AXI4标准,从而使该接口获得了更广泛的应用；
2. 基于AX4的目标设计平台可加速嵌入式处理、DSP以及连接功能设计开发；

### **2、AXI4 功能**

AXI4协议**基于猝发式传输机制**。

在地址通道上,每个交易有地址和控制信息,这些信息描述了需要传输的数据性质在主设备和从设备之间所传输的数据分别使用到从设备的写数据通道和到主设备的读数据通道。

在从主设备到从设备的写数据交易中,AXI有一个额外的写响应通道,从设备通过该通道向主设备发出信号表示完成写交易

所有的AX4包含了5个不同的通道

1. 读地址通道( Read address channel,AR)（包含ARVALID, ARADDR, ARREADY信号）；
2. 写地址通道( Write address channel,AW)（包含AWVALID，AWADDR, AWREADY信号）；
3. 读数据通道( Read data channel,R)（包含RVALID, RDATA, RREADY, RRESP信号）；
4. 写数据通道( Write data channel,W)（包含WVALID, WDATA，WSTRB, WREADY信号）；
5. 写响应通道( Write response channel,B)（包含BVALID, BRESP, BREADY信号）；
6. 系统通道（包含：ACLK，ARESETN信号）；

每个通道由一个信号集构成,并且使用双向的VALID和 READY握手信号机制。

信息源使用VALID信号,表示在通道上存在可用的有效数据或者控制信息;而信息接收源使用 READY信号,表示可以接收数据。

读数据通道和写数据通道也包含LAST信号,该信号用来表示在一个交易发生时,最后一个传输的数据

使用读地址和读数据通道进行读取数据

<img src="/images/post_images/amba_03_axi/amba_03_axi_01.png">

使用写地址和写数据通道进行读取数据

<img src="/images/post_images/amba_03_axi/amba_03_axi_02.png">

### **3 、AXI 信号概述**

**AXI通道及信号**

读和写交易有各自的地址通道。地址通道上给出交易所要求的地址和控制信息。AX4读和写地址通道包括下面的机制

1. 可变长度的猝发操作,每次猝发操作包含1-256数据；
2. 提供服务质量(QoS)信号；
3. 支持多个区域接口；
4. 猝发传输不能超过4k边界；
5. 包裹、递增和非递增猝发；
6. 使用互斥和锁的原子操作；
7. 系统级缓存和缓冲控制；
8. 安全和特权访问；

- 写地址通道：这个通道中包含的信号的命名格式为 s_axi_aw...
- 写数据通道：这个通道中包含的信号的命名格式为 s_axi_w...
- 写响应通道：这个通道中包含的信号的命名格式为 s_axi_b...
- 读地址通道：这个通道中包含的信号的命名格式为 s_axl_ar...
- 读数据通道：这个通道中包含的信号的命名格式为 s_axi_r...

#### 3.1 全局信号

| 信号    | 源     | 描述                                         |
| ------- | ------ | -------------------------------------------- |
| ACLK    | 时钟源 | 全局时钟信号，所有信号都在时钟的边沿进行采样 |
| ARESETn | 复位源 | 全局复位信号，该信号低电平有效               |

#### 3.2 低功耗接口信号

| 信号名  | 源         | 描述                                             |
| ------- | ---------- | ------------------------------------------------ |
| CSYSREQ | 时钟控制器 | 系统退出低功耗请求，此信号从“时钟控制器”到“外设” |
| CSYSACK | 外设       | 退出低功耗状态确认                               |
| CACTIVE | 外设       | 外设请求时钟有效                                 |

#### 3.3 写地址通道

| 信号名        | 源   | 描述                                                         |
| ------------- | ---- | ------------------------------------------------------------ |
| AWID[3:0]     | 主机 | 写地址ID，用来标志一组写信号                                 |
| AWADDR[31:0]  | 主机 | 写地址。写地址信号给出写猝发交易的第一个传输地址。相关的控制信号线用于确定猝发中剩余传输的地址。 |
| AWLEN[7:0]    | 主机 | 突发长度，给出突发中准确地传输个数，该信息给出了和地址相关的数据传输数量 |
| AWSIZE[2:0]   | 主机 | 猝发大小。这个信号确定猝发中每个传输的大小。字节通道选通用来说明需要更新的字节通道。 |
| AWBURST[1:0]  | 主机 | 猝发类型。该信息与大小信息一起,表示在猝发过程中,地址如何用于每个传输 |
| AWLOCK        | 主机 | 总线锁信号，这个信号提供了关于传输原子特性的额外信息(普通或互斥访间) |
| AWCACHE[3:0]  | 主机 | 缓存类型。这个信号表示可缓冲、可缓存、写通过、写回和分配交易属性。 |
| AWPROT[2:0]   | 主机 | 保护类型。这个信号表示交易的普通、特权、或安全保护级,以及交易是数据访问还是指令访问。 |
| AWQOS[3:0]    | 主机 | 质量服务QoS，用于每个写交易的地址通道上的4位QoS标识符(可作为优先级标志) |
| AWREGION[3:0] | 主机 | 用于每个写交易的地址通道上的域标识符                         |
| AWUSER        | 主机 | 用户自定义信号                                               |
| AWVALID       | 主机 | 写地址有效。这个信号表示写地址有效和控制信息是可用的。该信号一直保持有效,直到响应信号 AWREADY为高 |
| AWREADY       | 从机 | 写地址准备。这个信号表示从设备准备接受地址和相关的控制信号   |

#### 3.4 写数据通道

写数据通道传送所有从主设备到从设备的写数据下表给出了写数据通道信号及信号定义。写数据通道包括:

(1)数据总线宽度:8、16、32、64、128、256、512和1024位宽度

(2)每8位有一个字节通道选通,用来表示数据总线上的哪个字节是有效的;

| 信号名      | 源   | 描述                                            |
| ----------- | ---- | ----------------------------------------------- |
| WID         | 主机 | 一次写传输的ID tag                              |
| WDATA[31:0] | 主机 | 写数据                                          |
| WSTRB[3:0]  | 主机 | 写数据有效的字节线，用来表明哪8bits数据是有效的 |
| WLAST       | 主机 | 表明此次传输是最后一个突发传输                  |
| WUSER       | 主机 | 用户自定义信号                                  |
| WVALID      | 主机 | 写有效，表明此次写有效                          |
| WREADY      | 从机 | 表明从机可以接收写数据                          |

#### 3.5 写响应信号

写响应通道提供了一种方法,用于从设备响应写交易。所有的写信号使用完成信号。每个响应用于次猝发的完成,而不是用于每个交易的数据。

读交易和写交易可以通过下面的交易例子进行说明

（1）读猝发交易

（2）重叠猝发交易

（3）写猝发交易

| 信号名     | 源   | 描述                     |
| ---------- | ---- | ------------------------ |
| BID[3:0]   | 从机 | 写响应ID tag             |
| BRESP[1:0] | 从机 | 写响应，表明写传输的状态 |
| BUSER      | 从机 | 用户自定义               |
| BVALID     | 从机 | 写响应有效               |
| BREADY     | 主机 | 表明主机能够接收写响应   |

#### 3.6 读地址通道

| 信号名        | 源   | 描述                                           |
| ------------- | ---- | ---------------------------------------------- |
| ARID[3:0]     | 主机 | 读地址ID，用来标志一组写信号                   |
| ARADDR[31:0]  | 主机 | 读地址，给出一次写突发传输的读地址             |
| ARLEN[7:0]    | 主机 | 突发长度，给出突发传输的次数                   |
| ARSIZE[2:0]   | 主机 | 突发大小，给出每次突发传输的字节数             |
| ARBURST[1:0]  | 主机 | 突发类型                                       |
| ARLOCK        | 主机 | 总线锁信号，可提供操作的原子性                 |
| ARCACHE[3:0]  | 主机 | 内存类型，表明一次传输是怎样通过系统的         |
| ARPROT[2:0]   | 主机 | 保护类型，表明一次传输的特权级及安全等级       |
| ARQOS[3:0]    | 主机 | 质量服务QoS                                    |
| ARREGION[3:0] | 主机 | 区域标志，能实现单一物理接口对应的多个逻辑接口 |
| ARUSER        | 主机 | 用户自定义信号                                 |
| ARVALID       | 主机 | 有效信号，表明此通道的地址控制信号有效         |
| ARREADY       | 从机 | 表明“从”可以接收地址和对应的控制信号           |

#### 3.7 读数据通道

读数据通道传送所有来自从设备到主设备的读数据及读相应信息。表2.5给出了读数据通道信号及其信号定义读数据通道包括:

(1)数据总线宽度:8、16、32、64、128、256、512和1024位宽度

(2)读响应表示读交易完成的状态

| 信号名      | 源   | 描述                                     |
| ----------- | ---- | ---------------------------------------- |
| RID[3:0]    | 从机 | 读ID tag                                 |
| RDATA[31:0] | 从机 | 读数据                                   |
| RRESP[1:0]  | 从机 | 读响应，表明读传输的状态                 |
| RLAST       | 从机 | 表明读突发的最后一次传输                 |
| RUSER       | 从机 | 用户自定义                               |
| RVALID      | 从机 | 读有效，表明此通道信号有效               |
| RREADY      | 主机 | 读准备，表明主机能够接收读数据和响应信息 |

### **4、读写传输**

#### 4.1 突发式读操作

当地址出现在地址总线后，传输的数据将出现在读数据通道上。设备保持 RVALID 为低直到读数据有效。为了表明一次突发式读写的完成，设备用 RLAST 信号来表示最后一个被传输的数据。

<img src="/images/post_images/amba_03_axi/amba_03_axi_03.png">

#### 4.2 突发式写操作

开始时主机发送地址和控制信息到写地址通道中，然后主机发送每一个写数据到写数据通道中。当主机发送最后一个数据时，WLAST 信号就变为高。当设备接收完所有数据之后他将一个写响应BRESP发送回主机来表明写事务完成。

<img src="/images/post_images/amba_03_axi/amba_03_axi_04.png">

### **5、AXI 通道握手信号关系**

为了避免死锁条件,必须考虑握手信号之间存在的依赖关系。在任何交易中:

(1)AⅪ互联中的 ⅤALID 信号不依赖于交易中其它元件的READY信号

(2) READY信号能等待ⅤALID信号的确认

#### 5.1 读传输中握手信号之间依赖关系

**在读交易中**

(1)在确认 ARREADY信号前,从设备能等待确认 ARVALID信

(2)在从设备通过确认RⅤALD信号开始返回数据前,必须等待确认所有的 ARVALID和 ARREADY信号

<img src="/images/post_images/amba_03_axi/amba_03_axi_05.png">

#### 5.2 写传输中握手信号之间依赖关系

**注意：**

（1）主机不一定得等待设备先给出AWREADY或WREADY信号信号后再给出信号AWVALID或WVLAID。

（2）设备可以等待信号AWVALID或WVALID信号有效或者两个都有效之后再给出AWREADY信号。

（3）设备可以等待AWVALID或WVALID信号有效或者两个信号都有效之后再给出WREADY信号。

**在写交易中:**

（1）在确认 AWVALID和 WVALID信号前,主设备不需要等待从设备确认 AWREADY或者 WREADY信号

（2）在确认 AWREADY前,从设备能等待 AWVALID或 WVALID信号,或者全部这两个信号

（3）在确认 WREADY前,从设备能等待 AWVALID或 WVALID信号,或者全部这两个信号

（4）从设备在确认 BVALID前,从设备必须等待确认所有的AWVALID和 AWREADY信号

（5）在确认BⅤALID前,从设备不需要等待主设备确认 BREADY信号

（6）在确认 BREADY前,主设备能等待 BVALID信号

<img src="/images/post_images/amba_03_axi/amba_03_axi_06.png">

### **6、AXI 猝发类型及地址计算**

#### 6.1 猝发类型

（1）固定猝发(Fixed burst)：突发传输过程中地址固定，用于FIFO访问

（2）增量触发(Incrementing burst)：增量突发，传输过程中，地址递增。增加量取决AxSIZE的值。

（3）回环猝发(Wrapping burst)：回环突发，和增量突发类似，但会在特定高地址的边界处回到低地址处。回环突发的长度只能是2,4,8,16次传输，传输首地址和每次传输的大小对齐。最低的地址整个传输的数据大小对齐。回环边界等于（AxSIZE*AxLEN）。

| ARBURST[1:0]<br>AWBURST[1:0] | 猝发类型    | 描述                                       | 访问             |
| ---------------------------- | ----------- | ------------------------------------------ | ---------------- |
| 00                           | 固定(FIXED) | 固定地址猝发                               | FIFO类型         |
| 01                           | 递增(INCR)  | 递增地址猝发                               | 通常的顺序存储器 |
| 10                           | 包裹(WRAP)  | 递增地址猝发，但是在边界时<br>返回到低地址 | 高速缓存行       |
| 11                           | 保留        | -                                          | -                |

注：对于包裹式的猝发方式,有两个限制

(1)开始地址必须对齐传输大小;

(2)猝发的长度必须是2,4,8或16。

(3)大于16拍的猝发传输只支持ICR类型。WRAP和FIXED类型只限于小于16拍的猝发传输。

#### 6.2 猝发地址计算（略）

此部分忽略，详情可查看[百度文库-AXI](https://wenku.baidu.com/view/45491979bf1e650e52ea551810a6f524ccbfcbd5.html?rec_flag=default&sxts=1582552068762)

### **7、AXI 互联结构模型**

（1）直通模式

（2）只转换模式

（3）N-1互联模式

（4）1-N互联模式

（5）N-M互联模式。

#### 7.1 直通模式

当只有一个主设备和一个从设备和AⅪ互联时,AXI互联不执行任何转换或流水线功能,

AXI互联结构退化成直接的线连接。在这种模式下,没有延迟存在,同时不消耗逻辑资源

<img src="/images/post_images/amba_03_axi/amba_03_axi_07.png">

#### 7.2 只转换模式

如图所示,当连接一个主设备和一个从设备时,AXI互联能执行不同的转换和流水线功能。这些功能主要包括

●数据宽度转换;

●时钟速率转化

●AXI4-Lite从适应

●AXI-3从适应;

●流水线(例如一个寄存器 Slice或者数据通道FIFO)。

在只转换模式下,AXI互联不包含仲裁、解码或布线逻辑,但是可能产生延迟。

<img src="/images/post_images/amba_03_axi/amba_03_axi_08.png">

#### 7.3 N-1互联模式

如图所示,AXI互联的一个普通的退化配置模式是,多个主设备访问一个从设备典型的情况是,一个存储器控制器,很显然需要仲裁逻辑。

这种情况下,AⅪI互联不需要地址译码逻辑(除非需要确认地址的有效范围)。在这个配置中也执行数据宽度和时钟速率的转换。

<img src="/images/post_images/amba_03_axi/amba_03_axi_09.png">

#### 7.4 1-N互联模式

如图所示,另一个AXI互联退化的结构是,个主设备,典型的处理器,访问多个存储器映射的从外设。在这种模式下,AXI互联不执行仲裁(在地址和写数据通道)。

<img src="/images/post_images/amba_03_axi/amba_03_axi_10.png">

#### 7.5 N-M互联模式

AXI互联提供了一种共享地址多数据流(SAMD)拓扑结构,这种结构中包含稀疏的数据交叉开关连接,单线程写和读地址仲裁。

如图所示,给出了种共享写和读地址仲裁的NM的AXI互联结构。

<img src="/images/post_images/amba_03_axi/amba_03_axi_11.png">

### **8、AXI Lite**

AX4-Lite接口是AX14接口的子集专用于和元件内的控制寄存器进行通信。AXI4-Lite允许构建简单的元件接口,这个接口是较小的,对设计和验证方面的要求更少。

AⅩ4-Lite接口的关键特性包含

- 所有交易的猝发长度为1;
- 所有访问数据的大小和数据总线宽度相同
- 支持数据总线宽度为32位或64位(要求64位原子访问)
- 所有的访问相当于 AWCACHE和 ARCACHE等于b000（非缓冲和非缓存的);
- 不支持互斥性操作;

| 全局信号 | 写地址通道 | 写数据通道 | 写响应通道 | 读地址通道 | 读数据通道 |
| -------- | ---------- | ---------- | ---------- | ---------- | ---------- |
| ACLK     | AWVALID    | WVALID     | BVALID     | ARVALID    | RVALID     |
| ARESETn  | AWREADY    | WREADY     | BREADY     | ARREADY    | RREADY     |
|          | AWADDR     | WDATA      | BRESP      | ARADDR     | RDATA      |
|          | AWPROT     | WSTRB      |            | ARPROT     | PRRESP     |

支持多个未完成的交易,但是一个从设备的设计允许通过合理的使用握手信号,对这种交易进行限制。

在 AXI-Lite中不支持 AXI IDS。这个定义规定了所有的交易必须是顺序的,所有的交易必须使用一个单独固定的ID值。从设备可选择支持 AXI ID信号,这样允许使用的从设备是全AXI接口,而不需要对接口进行修改。

AXI4-Lite支持写选通。这样允许实现多个不同大小的寄存器,也允许实现可以使用字节和半字访问进行写操作的存储器结构。所有的主接口和互联必须提供正确的写选通信号。所有的从设备元件可以选择是否使用写选通信号。对于提供类似存储器行为的从设备元件必须充分的支持写选通

### **9、AXI4-Stream**

AXI4- Stream协议作为一个标准的接口,这个接口用于连接希望交换数据的元件。接口用于将产生数据的主设备和接收数据的一个从设备连接。当很多元件和从元件连接时,也能使用这个协议。协议支持使用具有相同设置共享总线的多个数据流,允许建立互联结构,这个结构能够执行扩展、压缩和路由操作

AXI-Stream接口支持很多不同的流类型。流协议在传输和包之间定义了联系。表2.11给出了AXI- Strean接口的信号定义。

| 信号          | 源     | 描述                                                         |
| ------------- | ------ | ------------------------------------------------------------ |
| ACLK          | 时钟源 | 全局时钟信号。所有信号在ACLK信号上升沿采样                   |
| ARESETn       | 复位源 | 全局复位信号，低电平有效                                     |
| TVALID        | master | TVALID表明主设备正在驱动一个有效的传输。当确认 TVALID和 TREADY信号后,发生一个传输 |
| TREADY        | slave  | TREADY表明在当前周期能接收一个传输                           |
| TDATA[8n-1:0] | master | TDATA是基本的有效载荷,用来提供跨越接口的数据。数据为整数个字节 |
| TSTRB[n-1:0]  | master | TSTRB为字节修饰符,用来描述 TDATA相关字节内容作为一个数字字节或者一个位置字节被处理。 |
| TKEEP[n-1:0]  | master | TKEEP是字节修饰符,用来表明 TDATA相关字节的内容是否作为数据流的一部分被处理TKEEP字节修饰符未被确认的那些相关的字节是空字节,可以从数据流中去除 |
| TLAST         | master | 包的边界，结束的最后一个数据标志位                           |
| TID[i-1:0]    | master | TID是数据流的标识符,用来表明不同的数据流。                   |
| TDEST[d-1:0]  | master | TDEST为数据流提供路由信息。                                  |
| TUSER[u-1:0]  | master | TUSER是用户定义的边带信息,这些信息能伴随数据流进行发送       |

TVALID和 TREADY握手信号用来确定跨越接口数据的时间。双向的流控制机制使得主设备和从设备能控制跨越接口所发送的数据和控制信息的速度。

对于个发生的传输,必须确认 TVALID和 TREADY信号。主设备不允许在确认 TVALID前,等待确认TREADY。

一旦确认 TVALID,必须一直保持这个状态,直到产生握手信号在确认相应的 TREADY信号前,一个从设备允许等待确认 TVALID。

如果从设备确认了 TREADY,在 TVALID信号确认前,允许不确认(释放) TREADY

#### 9.1 TVALID在TREADY前的握手信号

如图给出了 TVALID在 TREADY前的握手信号。从图中可以看出,主设备给出数据和控制信号,并且确认 TVALID信号为高。一旦主设备确认了 VALID,来自主设备的数据或者控制信息保持不变,这种状态一直保持到从设备驱动 TREADY信号为高,用来表示从设备可以接收数据和控制信号。

在这种情况下,一旦从设备确认TREADY为高,则进行传输。箭头标记的地方表示传输传输

<img src="/images/post_images/amba_03_axi/amba_03_axi_12.png">

#### 9.2 TREADY在 TVALID前的握手信号

如图给出了 TREADY在 TVALID前的握手信号图。图中可以看出,从设备在数据和控制信息有效前,驱动 TREADY信号为高。这表示,目的设备能在一个ACLK周期内接收数据和控制信息。

在这种情况旦主机确认 TVALID信号为高,则开始传输。箭头标记的地方表示传输开始。

<img src="/images/post_images/amba_03_axi/amba_03_axi_13.png">

#### 9.3 TVALID和 TREDAY握手

如图给出了 TVALID和 TREADY握手的图。在一个ACLK周期内,主设备确认 TVALID为高,从设备确认 TREADY为高。在箭头标记的地方产生传输。

<img src="/images/post_images/amba_03_axi/amba_03_axi_14.png">

### **10、附加内容**

<img src="/images/post_images/amba_03_axi/amba_03_axi_15.png">

<img src="/images/post_images/amba_03_axi/amba_03_axi_16.png">

### 11、Alex 博客园笔记

链接 https://www.cnblogs.com/yuandonghua/p/11936357.html

#### 11.1 outstanding（独立）

<img src="/images/post_images/amba_03_axi/amba_03_axi_17.png">

#### 11.2 interleaving（间插）

<img src="/images/post_images/amba_03_axi/amba_03_axi_18.png">

#### 11.3 out-of-oder（乱序）

<img src="/images/post_images/amba_03_axi/amba_03_axi_19.png">

#### 11.4 写数据优先于写地址

<img src="/images/post_images/amba_03_axi/amba_03_axi_20.png">

#### 11.5 大小端

小端：低地址数据放在总线bus的低位。

大端：低地址数据放在总线bus的高位。

#### 11.6 INCR 

INCR模式 master 只提供首地址，地址累加是 slave 端做的

#### 11.7 原子操作

##### 11.7.1 原子操作的用途

在多线程的操作系统中，都有一个获取线程锁的过程，这个锁是唯一的，一个线程抢到了其他线程就抢不到，如何实现这个功能呢？加入将内存的一个变量作为锁的标志，如果这个标志位0表示没有线程抢这个锁，如果为1表示某个线程抢到了这个锁。那么在抢锁之前先要看一下这个标志是否为0，如果为0表示锁是空闲的可以抢，为了表示抢到了这个锁，还得把这个变量置为1。这个抢锁的过程就至少需要有一读一写。但是在多线程操作的过程中，可能很多线程都在读取这个变量，都读到的值为0（读的时间还是比较长的，多核并发完全可以读多次），然后所有线程都写1，这样就造成了多个线程都得到了锁，与锁唯一的要求不合。也就是说通过软件手段是不能保证某个值被一个线程（Master）读取和写入的过程中没有被其他线程（Master）读取和写入。这就要求线程支持原子操作。

由于内存在使用过程中会出现ecc错误，需要刷新数据来纠正这些错误，操作系统通过内存巡检来完成刷新操作，内存巡检就是读取内存的值，通过ecc校验更正错误值，然后写入到内存，系统读取数据后，操作系统还是在正常运行的，内存上的程序很有可能把内部数据修改了，如果还是拿原来读取的数据ecc校验后写入就会冲掉程序保存的数据，这当然是不行的。这个时候内存巡检就要用到原子操作，巡检值使用exlusive方式读取内存，让这段内存记录在读取数据后内存数据有没有被改写过，如果被改写过，ecc校验后的数据使用exlusive方式写入的时候就会不成功，防止覆盖新的数据。巡检程序发现写入不成功就重新巡检这段内存，直到成功。

##### 11.7.2 exlusive 原子操作

Master_A以exclusive方式读取Salve的一段地址（以lane_cash为单位，一般为64byte）的值后，相当于Master通知slave监控这段地址的写，slave的一个moniter会纪录这个Master_A，如果Master_A在写入这个slave之前没有其他Master写过这个数据的话，Master_A往这段地址写入数据是会返回一个Exok即原子操作成功，指示数据正确写入；如果在Master_A写入数据之前有其他Master也往slave的这段地址写过数据，那么Master_A以exlusive写数据的操作会返回ok，这其实表示exclusive操作失败了，数据也被moniter阻挡没有写入到slave中。这样保证读写这一整个过程中，软件知道是不是只有一个线程（Master）在写这段地址（其他线程在这个过程可以读），也只有exlusive写返回Exok后才说明线程锁抢占成功，这样就只有一个线程能抢占成功。

是一种应用场景相关的操作，在多核CPU中，为了保证一个master对slave的访问操作不让其他master来访问，保证访问slave的数据不被其他master改写。有点像多线程中的线程锁。在AXI3.0的时候有normal access/exclusive access/locked access， 其中normal access是不进行任何干预的访问，exclusive则是slave端监控一下，在master访问期间有没有其他master访问过，如果访问过就给告警什么的，让master重新访问一遍。locked access这种模式在AXI 4.0取消了，即硬件锁定，其他master访问不了master到slave的总线，这种方式对性能影响很大，所以取消了。

#### 11.8 cash

cash是slave端的一个缓冲，如果多个设备都访问slave的某一部分数据，那么这部分数据可以缓存到cash中，只要第一个master访问后，其他master访问的部分数据时就不去slave中去取这些数据，而是直接从cash中取出来，这样节省时间。axcash信号在总线中是透传的。在与AXI相连的CHI协议中实现实现了cash操作。

<img src="/images/post_images/amba_03_axi/amba_03_axi_21.png">

#### 11.9 额外信号 Qos/user

Qos和user在总线中也通常是透传，Qos有时候用于多个master访问的优先级用于仲裁。

#### 11.10 应答信号：BRESP/RRESP

（1）写操作单独有一个写应答通道；读应答RRESP与读数据集成在同一通道；

（2）对于写操作，每个burst只有一个写应答BRESP，且必须在最后一拍写数据后产生；读操作每一拍数据都有对应的读应答信号返回；

####  11.11 ID

Master无需知道某个ID被其他设备使用了没有，应为interconnect会在Master的ID上额外添加8bit，来区分不同Master的ID。

#### 11.12 低功耗操作

开启低功耗模式：Master拉低CSYSREQ信号，SLAVE收到后等SLAVE的任务处理完后拉低CACTIVE表示响应，并且在时钟关闭后拉低CSYSACK表示响应。

撤销低功耗模式：Master拉起CSYSREQ信号，SLAVE接收到以后拉高CACTIVE，解开时钟后，拉高CSYSACK信号。

<img src="/images/post_images/amba_03_axi/amba_03_axi_22.png">

​              

​                          

​                          

[  完  ]